<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spotify Music Downloader</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-green-400 via-green-500 to-green-600 min-h-screen flex items-center justify-center p-4">

  <!-- WhatsApp Popup -->
  <div id="wa-popup" class="fixed bottom-6 right-6 bg-white shadow-2xl rounded-xl p-4 w-72 z-50">
    <p class="text-gray-800 font-semibold mb-2">ğŸ“¢ Join WhatsApp Channel</p>
    <a href="https://whatsapp.com/channel/0029VbBhNn1KgsNr47ZTsg1C" target="_blank"
      class="block text-center bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg transition">
      Join Now
    </a>
    <button onclick="closeWA()" class="text-xs text-gray-500 mt-2 underline w-full">Close</button>
  </div>

  <!-- Main Card -->
  <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-2xl">
    <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">
      ğŸ“± Spotify Music Downloader ğŸ“±
    </h1>

    <input id="spotify-url" type="text"
      placeholder="Paste Spotify Track URL"
      class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none mb-2">

    <p id="detect" class="text-sm text-gray-600 mb-4 hidden"></p>

    <button id="convert-btn"
      class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-lg transition">
      Convert & Download
    </button>

    <!-- Loader -->
    <p id="loading" class="text-center text-gray-600 mt-4 hidden">â³ Converting...</p>

    <!-- Result -->
    <div id="result" class="mt-6 hidden">
      <p class="text-gray-700 mb-2 font-medium">Download Link:</p>
      <a id="download-link" href="#" target="_blank"
        class="block bg-green-600 hover:bg-green-700 text-white text-center py-2 rounded-lg">
        â¬‡ï¸ Download MP3
      </a>
    </div>

    <!-- Error -->
    <div id="error" class="text-red-600 mt-4 hidden"></div>

    <!-- Credits -->
    <p class="text-center text-xs text-gray-500 mt-8">
      API Type: 3rd Party (Unofficial but Legal)<br>
      API Source: spotmate.online<br>
      Coded by <span class="font-semibold">@Salar</span><br>
      Credit â€” Made by â€”ÍÍŸÍâ˜… <span class="font-semibold">SÃ‚ğ™‡Ã‚ğ˜™ KÄªÆğº âœ§âœ¿</span>
    </p>
  </div>

  <script>
    const input = document.getElementById('spotify-url');
    const btn = document.getElementById('convert-btn');
    const detect = document.getElementById('detect');
    const loading = document.getElementById('loading');
    const result = document.getElementById('result');
    const error = document.getElementById('error');
    const link = document.getElementById('download-link');

    function closeWA() {
      document.getElementById('wa-popup').style.display = 'none';
    }

    input.addEventListener('input', () => {
      const url = input.value;
      detect.classList.add('hidden');

      if (!url.includes('spotify.com')) return;

      let type = '';
      if (url.includes('/track/')) type = 'ğŸµ Track detected';
      else if (url.includes('/album/')) type = 'ğŸ’¿ Album detected';
      else if (url.includes('/playlist/')) type = 'ğŸ“‚ Playlist detected';
      else if (url.includes('/artist/')) type = 'ğŸ‘¤ Artist detected';

      if (type) {
        detect.textContent = type;
        detect.classList.remove('hidden');
      }
    });

    btn.onclick = async () => {
      const url = input.value.trim();
      error.classList.add('hidden');
      result.classList.add('hidden');

      if (!url || !url.includes('spotify.com')) {
        error.textContent = 'Please enter a valid Spotify URL';
        error.classList.remove('hidden');
        return;
      }

      loading.classList.remove('hidden');

      try {
        const apiUrl = `https://spotdll.vercel.app/api/convert?url=${encodeURIComponent(url)}`;
        const res = await fetch(apiUrl);
        const data = await res.json();

        if (!data.success) throw new Error('Conversion failed');

        link.href = data.downloadUrl || data.url;
        result.classList.remove('hidden');
      } catch (e) {
        error.textContent = 'Failed to fetch download link';
        error.classList.remove('hidden');
      } finally {
        loading.classList.add('hidden');
      }
    };
  </script>

</body>
</html>
